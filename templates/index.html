{% extends "base.html" %}

{% block title %}FIFA World Cup 2026 - Predict & Win{% endblock %}

{% block content %}
<div class="matches-grid">
    {% for match in matches %}
    <div class="match-card {% if match.prediction %}submitted{% endif %} {% if match.prediction and match.actual_result %}{% if match.prediction == match.actual_result %}correct{% else %}incorrect{% endif %}{% endif %}">
        <div class="match-info">
            <div class="match-date">{{ match.date }}</div>
            <div class="stadium">{{ match.stadium }}</div>
        </div>
     {% set clean_game = namespace(value=True) %}

    {% if '/' in match.team1 %}
        {% set team1 = "Team1" %}
        {% set clean_game.value = False %}
    {% else %}
        {% set team1 = match.team1 %}
    {% endif %}

    {% if '/' in match.team2 %}
        {% set team2 = "Team2" %}
        {% set clean_game.value = False %}
    {% else %}
        {% set team2 = match.team2 %}
    {% endif %}

        <div class="teams-container">
            <div class="team">
                <div class="team-flag">{{ match.team1_flag }}</div>
                <div class="team-name">{{ match.team1 }}</div>
            </div>
            
            <div class="vs">VS</div>
            
            <div class="team">
                <div class="team-flag">{{ match.team2_flag }}</div>
                <div class="team-name">{{ match.team2 }}</div>
            </div>
        </div>

        <form id="form_{{ match.id }}" class="prediction-form" onsubmit="event.preventDefault(); submitPrediction({{ match.id }});">
            <div class="prediction-buttons">
                <button type="button" 
                        class="predict-btn team1 {% if match.prediction == '1' %}selected{% endif %}" 
                        data-match="{{ match.id }}" 
                        data-prediction="1"
                        onclick="selectPrediction({{ match.id }}, '1', this)"
                        {% if match.prediction %}disabled{% endif %}>
                    <span>{{ team1 }}</span>
                </button>
                <button type="button" 
                        class="predict-btn draw {% if match.prediction == '3' %}selected{% endif %}" 
                        data-match="{{ match.id }}" 
                        data-prediction="3"
                        onclick="selectPrediction({{ match.id }}, '3', this)"
                        {% if match.prediction %}disabled{% endif %}>
                    <span>Draw</span>
                </button>
                <button type="button" 
                        class="predict-btn team2 {% if match.prediction == '2' %}selected{% endif %}" 
                        data-match="{{ match.id }}" 
                        data-prediction="2"
                        onclick="selectPrediction({{ match.id }}, '2', this)"
                        {% if match.prediction %}disabled{% endif %}>
                    <span>{{ team2 }}</span>
                </button>
            </div>
            
            <button type="submit" 
                    id="submit_{{ match.id }}" 
                    class="submit-btn"
                    {% if match.prediction %}disabled{% endif %}
                    {% if not match.prediction %}disabled{% endif %}>
                Submit and View
            </button>
            <div> 
                {% if match.win > 0 and clean_game %}
                    Win: {{ match.win }} | Draw: {{ match.draw }} | Loss: {{ match.loss }}
                {% endif %}
            </div>
        </form>

        {% if match.prediction %}
            {% if match.actual_result is none %}
                <div class="result-message pending">
                    ‚è≥ Prediction Submitted! Match result pending...
                </div>
            {% elif match.prediction == match.actual_result %}
                <div class="result-message correct">
                    ‚úÖ Correct! You predicted it right! üéâ
                </div>
            {% else %}
                <div class="result-message incorrect">
                    ‚ùå Wrong! The actual result was: 
                    {% if match.actual_result == '1' %}{{ match.team1 }}
                    {% elif match.actual_result == '2' %}{{ match.team2 }}
                    {% else %}Draw{% endif %}
                </div>
            {% endif %}
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}
